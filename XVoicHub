local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local lp = Players.LocalPlayer
local pg = lp:WaitForChild("PlayerGui")

local character = lp.Character or lp.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local hrp = character:WaitForChild("HumanoidRootPart")

local defaultWalkSpeed = humanoid.WalkSpeed
local speedEnabled = false
local antiHitEnabled = false
local speedValue = 50

local antiHB, stateConn, speedHB

local function bindChar(char)
	character = char
	humanoid = character:WaitForChild("Humanoid")
	hrp = character:WaitForChild("HumanoidRootPart")
	defaultWalkSpeed = humanoid.WalkSpeed
	if speedEnabled then humanoid.WalkSpeed = speedValue end
	if antiHitEnabled then
		humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
		humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
		humanoid:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding, false)
	end
end

lp.CharacterAdded:Connect(bindChar)

local function stopAnti()
	if antiHB then antiHB:Disconnect() antiHB = nil end
	if stateConn then stateConn:Disconnect() stateConn = nil end
end

local function startAnti()
	stopAnti()
	stateConn = humanoid.StateChanged:Connect(function(_, new)
		if antiHitEnabled then
			if new == Enum.HumanoidStateType.Ragdoll or new == Enum.HumanoidStateType.FallingDown or new == Enum.HumanoidStateType.PlatformStanding then
				task.defer(function()
					if antiHitEnabled and humanoid then
						humanoid.PlatformStand = false
						humanoid:ChangeState(Enum.HumanoidStateType.Running)
					end
				end)
			end
		end
	end)
	antiHB = RunService.Heartbeat:Connect(function()
		if not antiHitEnabled or not hrp or not hrp.Parent or humanoid.Health <= 0 then return end
		local v = hrp.AssemblyLinearVelocity
		local w = hrp.AssemblyAngularVelocity
		hrp.AssemblyAngularVelocity = Vector3.new(0, w.Y, 0)
		if humanoid.PlatformStand then humanoid.PlatformStand = false end
		local st = humanoid:GetState()
		if st == Enum.HumanoidStateType.Ragdoll or st == Enum.HumanoidStateType.FallingDown or st == Enum.HumanoidStateType.PlatformStanding or st == Enum.HumanoidStateType.Physics then
			humanoid:ChangeState(Enum.HumanoidStateType.Running)
		end
		if not speedEnabled then
			local minWalk = math.max(16, defaultWalkSpeed)
			if humanoid.WalkSpeed < minWalk then
				humanoid.WalkSpeed = minWalk
			end
		end
		local xz = Vector3.new(v.X, 0, v.Z)
		local limit = math.max(humanoid.WalkSpeed, speedValue) + 6
		if xz.Magnitude > limit + 2 then
			xz = xz.Unit * limit
			hrp.AssemblyLinearVelocity = Vector3.new(xz.X, v.Y, xz.Z)
		end
	end)
end

local function applyAnti(on)
	antiHitEnabled = on
	if on then
		humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
		humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
		humanoid:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding, false)
		startAnti()
	else
		humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, true)
		humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, true)
		humanoid:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding, true)
		stopAnti()
	end
end

local function stopSpeed()
	if speedHB then speedHB:Disconnect() speedHB = nil end
end

local function applySpeed(on)
	speedEnabled = on
	if on then
		humanoid.WalkSpeed = speedValue
		stopSpeed()
		speedHB = RunService.Heartbeat:Connect(function()
			if not speedEnabled or humanoid.Health <= 0 or not hrp or not hrp.Parent then return end
			if humanoid.WalkSpeed ~= speedValue then
				humanoid.WalkSpeed = speedValue
			end
			local dir = humanoid.MoveDirection
			if dir.Magnitude > 0.01 then
				dir = dir.Unit
				local v = hrp.AssemblyLinearVelocity
				local currentXZ = Vector3.new(v.X, 0, v.Z)
				local targetXZ = dir * speedValue
				local alpha = 0.12
				local newXZ = currentXZ + (targetXZ - currentXZ) * alpha
				local cap = speedValue + 6
				if newXZ.Magnitude > cap then newXZ = newXZ.Unit * cap end
				hrp.AssemblyLinearVelocity = Vector3.new(newXZ.X, v.Y, newXZ.Z)
			end
		end)
	else
		humanoid.WalkSpeed = defaultWalkSpeed
		stopSpeed()
	end
end

local gui = Instance.new("ScreenGui")
gui.Name = "XVoicHub"
gui.ResetOnSpawn = false
gui.Parent = pg

local frame = Instance.new("Frame")
frame.Name = "Main"
frame.Parent = gui
frame.Size = UDim2.new(0, 260, 0, 200)
frame.Position = UDim2.new(0, 50, 0, 50)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
frame.BorderSizePixel = 0
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = frame
local stroke = Instance.new("UIStroke")
stroke.Thickness = 1.5
stroke.Color = Color3.fromRGB(60, 60, 80)
stroke.Parent = frame
local grad = Instance.new("UIGradient")
grad.Color = ColorSequence.new(Color3.fromRGB(28,28,36), Color3.fromRGB(20,20,26))
grad.Rotation = 90
grad.Parent = frame

-- Tabs
local tabBar = Instance.new("Frame")
tabBar.Name = "TabBar"
tabBar.Parent = frame
tabBar.Size = UDim2.new(1, 0, 0, 34)
tabBar.Position = UDim2.new(0, 0, 0, 38)
tabBar.BackgroundTransparency = 1

local content = Instance.new("Frame")
content.Name = "Content"
content.Parent = frame
content.Size = UDim2.new(1, 0, 1, -72)
content.Position = UDim2.new(0, 0, 0, 72)
content.BackgroundTransparency = 1

local mainPage = Instance.new("Frame")
mainPage.Name = "MainPage"
mainPage.Parent = content
mainPage.Size = UDim2.new(1, 0, 1, 0)
mainPage.BackgroundTransparency = 1

local pvpPage = Instance.new("Frame")
pvpPage.Name = "PvPPage"
pvpPage.Parent = content
pvpPage.Size = UDim2.new(1, 0, 1, 0)
pvpPage.Visible = false
pvpPage.BackgroundTransparency = 1

local title = Instance.new("TextLabel")
title.Parent = frame
title.Size = UDim2.new(1, 0, 0, 38)
title.BackgroundTransparency = 1
title.Text = "XVoic Hub"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextSize = 22
title.Font = Enum.Font.GothamBold

local dragBar = Instance.new("Frame")
dragBar.Parent = frame
dragBar.Size = UDim2.new(1, 0, 0, 38)
dragBar.BackgroundTransparency = 1

local hideBtn = Instance.new("TextButton")
hideBtn.Parent = frame
hideBtn.Size = UDim2.new(0, 28, 0, 28)
hideBtn.Position = UDim2.new(1, -34, 0, 5)
hideBtn.Text = "âˆ’"
hideBtn.BackgroundColor3 = Color3.fromRGB(60, 65, 90)
hideBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
hideBtn.TextSize = 16
hideBtn.AutoButtonColor = true
hideBtn.Font = Enum.Font.GothamBold
local hideCorner = Instance.new("UICorner")
hideCorner.CornerRadius = UDim.new(1, 0)
hideCorner.Parent = hideBtn

local miniBtn = Instance.new("TextButton")
miniBtn.Parent = gui
miniBtn.Size = UDim2.new(0, 92, 0, 28)
miniBtn.Position = UDim2.new(0, 12, 0, 12)
miniBtn.Text = "XVoic Hub"
miniBtn.BackgroundColor3 = Color3.fromRGB(45, 50, 70)
miniBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
miniBtn.TextSize = 14
miniBtn.AutoButtonColor = true
miniBtn.Font = Enum.Font.Gotham
local miniCorner = Instance.new("UICorner")
miniCorner.CornerRadius = UDim.new(0, 8)
miniCorner.Parent = miniBtn
miniBtn.Visible = false

local function addTabButton(text, offsetX)
	local b = Instance.new("TextButton")
	b.Parent = tabBar
	b.Size = UDim2.new(0, 90, 0, 28)
	b.Position = UDim2.new(0, 12 + offsetX, 0, 3)
	b.Text = text
	b.BackgroundColor3 = Color3.fromRGB(45, 50, 70)
	b.TextColor3 = Color3.fromRGB(255, 255, 255)
	b.TextSize = 14
	b.AutoButtonColor = true
	b.Font = Enum.Font.Gotham
	local c = Instance.new("UICorner")
	c.CornerRadius = UDim.new(0, 8)
	c.Parent = b
	local s = Instance.new("UIStroke")
	s.Color = Color3.fromRGB(70, 80, 110)
	s.Thickness = 1
	s.Parent = b
	return b
end

local mainTabBtn = addTabButton("Main", 0)
local pvpTabBtn = addTabButton("PvP", 98)

local function switchTab(name)
	if name == "Main" then
		mainPage.Visible = true
		pvpPage.Visible = false
		mainTabBtn.BackgroundColor3 = Color3.fromRGB(50, 160, 100)
		pvpTabBtn.BackgroundColor3 = Color3.fromRGB(45, 50, 70)
	else
		mainPage.Visible = false
		pvpPage.Visible = true
		mainTabBtn.BackgroundColor3 = Color3.fromRGB(45, 50, 70)
		pvpTabBtn.BackgroundColor3 = Color3.fromRGB(50, 160, 100)
	end
end
switchTab("Main")
mainTabBtn.MouseButton1Click:Connect(function() switchTab("Main") end)
pvpTabBtn.MouseButton1Click:Connect(function() switchTab("PvP") end)

speedBtn.Parent = frame
speedBtn.Parent = speedBtnParent
speedBtn.Size = UDim2.new(1, -24, 0, 36)
speedBtn.Position = UDim2.new(0, 12, 0, 0)
speedBtn.BackgroundColor3 = Color3.fromRGB(45, 50, 70)
speedBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
speedBtn.TextSize = 17
speedBtn.AutoButtonColor = true
speedBtn.Font = Enum.Font.Gotham
local spBCorner = Instance.new("UICorner")
local spBCorner = Instance.new("UICorner")
spBCorner.CornerRadius = UDim.new(0, 8)
spBCorner.Parent = speedBtn
local spBStroke = Instance.new("UIStroke")
spBStroke.Color = Color3.fromRGB(70, 80, 110)
spBStroke.Thickness = 1
spBStroke.Parent = speedBtn

local speedBox = Instance.new("TextBox")
speedBox.Parent = mainPage
speedBox.Size = UDim2.new(1, -24, 0, 34)
speedBox.Position = UDim2.new(0, 12, 0, 44)
speedBox.Text = tostring(speedValue)
speedBox.PlaceholderText = "Speed value"
speedBox.BackgroundColor3 = Color3.fromRGB(32, 34, 46)
speedBox.TextColor3 = Color3.fromRGB(255, 255, 255)
speedBox.TextSize = 17
speedBox.ClearTextOnFocus = false
speedBox.Font = Enum.Font.Gotham
local spXCorner = Instance.new("UICorner")
spXCorner.CornerRadius = UDim.new(0, 8)
spXCorner.Parent = speedBox
local spXStroke = Instance.new("UIStroke")
spXStroke.Color = Color3.fromRGB(60, 70, 95)
spXStroke.Thickness = 1
spXStroke.Parent = speedBox

local antiBtn = Instance.new("TextButton")
antiBtn.Parent = mainPage
antiBtn.Size = UDim2.new(1, -24, 0, 36)
antiBtn.Position = UDim2.new(0, 12, 0, 88)
antiBtn.Text = "Anti-Hit: OFF"
antiBtn.BackgroundColor3 = Color3.fromRGB(45, 50, 70)
antiBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
antiBtn.TextSize = 17
antiBtn.AutoButtonColor = true
antiBtn.Font = Enum.Font.Gotham
local aBCorner = Instance.new("UICorner")
aBCorner.CornerRadius = UDim.new(0, 8)
aBCorner.Parent = antiBtn
local aBStroke = Instance.new("UIStroke")
aBStroke.Color = Color3.fromRGB(70, 80, 110)
aBStroke.Thickness = 1
aBStroke.Parent = antiBtn

local function setButtonState(btn, on)
	if on then
		btn.TextColor3 = Color3.fromRGB(255, 255, 255)
		btn.BackgroundColor3 = Color3.fromRGB(50, 160, 100)
	else
		btn.TextColor3 = Color3.fromRGB(255, 255, 255)
		btn.BackgroundColor3 = Color3.fromRGB(45, 50, 70)
	end
end

setButtonState(speedBtn, false)
setButtonState(antiBtn, false)

speedBtn.MouseButton1Click:Connect(function()
	speedEnabled = not speedEnabled
	speedBtn.Text = speedEnabled and "Speed: ON" or "Speed: OFF"
	setButtonState(speedBtn, speedEnabled)
	applySpeed(speedEnabled)
end)

antiBtn.MouseButton1Click:Connect(function()
	antiHitEnabled = not antiHitEnabled
	antiBtn.Text = antiHitEnabled and "Anti-Hit: ON" or "Anti-Hit: OFF"
	setButtonState(antiBtn, antiHitEnabled)
	applyAnti(antiHitEnabled)
end)

speedBox.FocusLost:Connect(function()
	local v = tonumber(speedBox.Text)
	if v and v > 0 and v < 1000 then
		speedValue = math.floor(v + 0.5)
		speedBox.Text = tostring(speedValue)
		if speedEnabled then humanoid.WalkSpeed = speedValue end
	else
		speedBox.Text = tostring(speedValue)
	end
end)

-- PvP Page: Aim Assist for "Laser" tools (camera aim)
local aimEnabled = false
local aimHB = nil
local aimFov = 60
local teamCheck = true
local aimPartName = "Head"

local aimBtn = Instance.new("TextButton")
aimBtn.Parent = pvpPage
aimBtn.Size = UDim2.new(1, -24, 0, 36)
aimBtn.Position = UDim2.new(0, 12, 0, 0)
aimBtn.Text = "AimAssist: OFF"
aimBtn.BackgroundColor3 = Color3.fromRGB(45, 50, 70)
aimBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
aimBtn.TextSize = 17
aimBtn.AutoButtonColor = true
aimBtn.Font = Enum.Font.Gotham
local aimBtnCorner = Instance.new("UICorner")
aimBtnCorner.CornerRadius = UDim.new(0, 8)
aimBtnCorner.Parent = aimBtn
local aimBtnStroke = Instance.new("UIStroke")
aimBtnStroke.Color = Color3.fromRGB(70, 80, 110)
aimBtnStroke.Thickness = 1
aimBtnStroke.Parent = aimBtn

local fovBox = Instance.new("TextBox")
fovBox.Parent = pvpPage
fovBox.Size = UDim2.new(1, -24, 0, 34)
fovBox.Position = UDim2.new(0, 12, 0, 44)
fovBox.Text = tostring(aimFov)
fovBox.PlaceholderText = "FOV (deg)"
fovBox.BackgroundColor3 = Color3.fromRGB(32, 34, 46)
fovBox.TextColor3 = Color3.fromRGB(255, 255, 255)
fovBox.TextSize = 17
fovBox.ClearTextOnFocus = false
fovBox.Font = Enum.Font.Gotham
local fovCorner = Instance.new("UICorner")
fovCorner.CornerRadius = UDim.new(0, 8)
fovCorner.Parent = fovBox
local fovStroke = Instance.new("UIStroke")
fovStroke.Color = Color3.fromRGB(60, 70, 95)
fovStroke.Thickness = 1
fovStroke.Parent = fovBox

local teamBtn = Instance.new("TextButton")
teamBtn.Parent = pvpPage
teamBtn.Size = UDim2.new(1, -24, 0, 36)
teamBtn.Position = UDim2.new(0, 12, 0, 88)
teamBtn.Text = "TeamCheck: ON"
teamBtn.BackgroundColor3 = Color3.fromRGB(45, 50, 70)
teamBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
teamBtn.TextSize = 17
teamBtn.AutoButtonColor = true
teamBtn.Font = Enum.Font.Gotham
local teamBtnCorner = Instance.new("UICorner")
teamBtnCorner.CornerRadius = UDim.new(0, 8)
teamBtnCorner.Parent = teamBtn
local teamBtnStroke = Instance.new("UIStroke")
teamBtnStroke.Color = Color3.fromRGB(70, 80, 110)
teamBtnStroke.Thickness = 1
teamBtnStroke.Parent = teamBtn

local partBox = Instance.new("TextBox")
partBox.Parent = pvpPage
partBox.Size = UDim2.new(1, -24, 0, 34)
partBox.Position = UDim2.new(0, 12, 0, 132)
partBox.Text = aimPartName
partBox.PlaceholderText = "AimPart (e.g., Head)"
partBox.BackgroundColor3 = Color3.fromRGB(32, 34, 46)
partBox.TextColor3 = Color3.fromRGB(255, 255, 255)
partBox.TextSize = 17
partBox.ClearTextOnFocus = false
partBox.Font = Enum.Font.Gotham
local partCorner = Instance.new("UICorner")
partCorner.CornerRadius = UDim.new(0, 8)
partCorner.Parent = partBox
local partStroke = Instance.new("UIStroke")
partStroke.Color = Color3.fromRGB(60, 70, 95)
partStroke.Thickness = 1
partStroke.Parent = partBox

local function getTarget()
	local cam = workspace.CurrentCamera
	if not cam then return nil end
	local best, bestAng = nil, math.huge
	for _, pl in ipairs(Players:GetPlayers()) do
		if pl ~= lp and pl.Character and pl.Character:FindFirstChild("Humanoid") and pl.Character:FindFirstChild("HumanoidRootPart") then
			local hum = pl.Character.Humanoid
			if hum.Health > 0 then
				if not teamCheck or (lp.Team ~= nil and pl.Team ~= lp.Team) or (lp.Team == nil) then
					local part = pl.Character:FindFirstChild(aimPartName) or pl.Character:FindFirstChild("Head")
					if part then
						local dir = (part.Position - cam.CFrame.Position).Unit
						local ang = math.deg(math.acos(math.clamp(dir:Dot(cam.CFrame.LookVector), -1, 1)))
						if ang < aimFov and ang < bestAng then
							best, bestAng = part, ang
						end
					end
				end
			end
		end
	end
	return best
end

local function stopAim()
	if aimHB then aimHB:Disconnect() aimHB = nil end
end

local function startAim()
	stopAim()
	aimHB = RunService.RenderStepped:Connect(function(dt)
		if not aimEnabled then return end
		local cam = workspace.CurrentCamera
		if not cam then return end
		local tgt = getTarget()
		if tgt then
			local look = (tgt.Position - cam.CFrame.Position).Unit
			local current = cam.CFrame
			local desired = CFrame.new(current.Position, current.Position + look)
			cam.CFrame = current:Lerp(desired, 0.2)
		end
	end)
end

aimBtn.MouseButton1Click:Connect(function()
	aimEnabled = not aimEnabled
	aimBtn.Text = aimEnabled and "AimAssist: ON" or "AimAssist: OFF"
	setButtonState(aimBtn, aimEnabled)
	if aimEnabled then startAim() else stopAim() end
end)

teamBtn.MouseButton1Click:Connect(function()
	teamCheck = not teamCheck
	teamBtn.Text = teamCheck and "TeamCheck: ON" or "TeamCheck: OFF"
	setButtonState(teamBtn, teamCheck)
end)

fovBox.FocusLost:Connect(function()
	local v = tonumber(fovBox.Text)
	if v and v > 5 and v <= 180 then
		aimFov = math.floor(v + 0.5)
		fovBox.Text = tostring(aimFov)
	else
		fovBox.Text = tostring(aimFov)
	end
end)

partBox.FocusLost:Connect(function()
	local name = tostring(partBox.Text or ""):gsub("%s+", "")
	if name ~= "" then
		aimPartName = name
		partBox.Text = aimPartName
	else
		partBox.Text = aimPartName
	end
end)

local dragging = false
local dragStart
local startPos
dragBar.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = frame.Position
	end
end)
dragBar.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = false
	end
end)
UserInputService.InputChanged:Connect(function(input)
	if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
end)
